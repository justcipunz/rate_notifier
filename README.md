# Rate Notifier

Микросервисный проект на FastAPI и Docker для отслеживания курса доллара и отправки уведомлений пользователям при достижении целевых отметок.

## Ключевые возможности

*   **Регистрация и аутентификация пользователей** с использованием JWT-токенов.
*   **Управление целевыми отметками:** пользователи могут создавать, просматривать и удалять свои персональные отметки курса.
*   **Фоновый сервис** для периодического получения актуального курса валют с внешнего API.
*   **Асинхронная обработка уведомлений** через брокер сообщений RabbitMQ, что обеспечивает слабую связанность и масштабируемость системы.
*   **Полная контейнеризация** с помощью Docker и Docker Compose для легкого развертывания и запуска.

## Архитектура проекта

Проект построен на гибридной микросервисной архитектуре, состоящей из трех независимых сервисов, базы данных и брокера сообщений.

*   `User Service`: Основной API-сервис, написанный на FastAPI. Отвечает за всю логику, связанную с пользователями и их данными (регистрация, логин, управление отметками).
*   `Rate Tracker Service`: Простой фоновый сервис, который периодически запрашивает курс доллара и публикует его в RabbitMQ.
*   `Notification Service`: Фоновый сервис-обработчик, который слушает сообщения о новом курсе из RabbitMQ, сравнивает его с отметками пользователей в базе данных и имитирует отправку уведомлений.
*   `PostgreSQL`: Реляционная база данных для хранения информации о пользователях и их отметках.
*   `RabbitMQ`: Брокер сообщений для асинхронного взаимодействия между сервисами.

### Схема взаимодействия
[Внешний API] <---(HTTP GET)--- [Rate Tracker Service] --->(сообщение)---> [RabbitMQ]
|
V
(сообщение)---> [Notification Service] --->(проверка/обновление)---> [PostgreSQL]
^
|
[Пользователь] <---(HTTP API)---> [User Service] <---------------------------------------(чтение/запись)--------------------------------------/


## Технологический стек

*   **Бэкенд:** Python 3.10, FastAPI, Pydantic, SQLAlchemy
*   **База данных:** PostgreSQL
*   **Брокер сообщений:** RabbitMQ (с библиотекой `pika`)
*   **HTTP-клиент:** `requests`
*   **Инфраструктура:** Docker, Docker Compose

## Установка и запуск

### Предварительные требования
*   Установленный Git
*   Установленный Docker Desktop

### Инструкция по запуску

1.  **Клонируйте репозиторий:**
    ```
    git clone <URL_вашего_репозитория>
    cd <имя_папки_проекта>
    ```

2.  **Настройте переменные окружения:**
    Создайте файл `.env` в корневой папке проекта. Вставьте в него содержимое `.env.example` (см. ниже).
    Вы можете изменить значения в файле `.env`, но для локального запуска подойдут и значения по умолчанию.

3.  **Запустите проект:**
    Выполните одну команду, которая соберет образы и запустит все контейнеры:
    ```
    docker-compose up --build
    ```

После запуска сервисы будут доступны по следующим адресам:
*   **User Service API (Swagger):** `http://localhost:8001/docs`
*   **RabbitMQ Management UI:** `http://localhost:15672` (логин/пароль: guest/guest или те, что указаны в вашем `.env`)

## Использование API

Вся документация по API доступна в интерактивном режиме через Swagger UI по адресу `http://localhost:8001/docs`.

### Основной сценарий использования:
1.  Зарегистрируйте нового пользователя через эндпоинт `POST /users/`.
2.  Получите JWT-токен, выполнив вход через эндпоинт `POST /token`.
3.  Нажмите на кнопку **"Authorize"** в правом верхнем углу Swagger UI и авторизуйтесь, используя полученный токен.
4.  Теперь вы можете использовать защищенные эндпоинты для создания (`POST /marks/`), просмотра (`GET /marks/`) и удаления (`DELETE /marks/{mark_id}`) своих отметок.

## Структура проекта
.
├── user_service/ # Код сервиса пользователей (FastAPI)
├── rate_tracker_service/ # Код сервиса отслеживания курса (фоновый скрипт)
├── notification_service/ # Код сервиса уведомлений (фоновый скрипт)
├── docker-compose.yml # Файл оркестрации контейнеров
├── .env # Файл с переменными окружения
├── .gitignore # Файл для исключения файлов из Git
└── README.md # Этот файл

# .env.example

POSTGRES_USER=user
POSTGRES_PASSWORD=password
POSTGRES_DB=app_db

USER_SERVICE_SECRET_KEY=a-very-secret-and-super-long-random-key-that-you-should-generate

RABBITMQ_DEFAULT_USER=guest
RABBITMQ_DEFAULT_PASS=guest
